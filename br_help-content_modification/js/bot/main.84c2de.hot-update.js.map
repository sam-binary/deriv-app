{"version":3,"sources":["webpack://deriv-bot/./src/services/api/helpers/server-time.js"],"names":["ServerTime","ws","clock_started","init_promise","PendingPromise","init","clearInterval","getTimeInterval","requestTime","setInterval","bind","console","log","client_time_at_request","getUTCEpoch","Date","sendRequest","time","time_response","processTimeResponse","resolve","response","error","server_time","client_time_at_response","server_time_at_response","updateTime","updateTimeInterval","getEpoch","Error","getLocalDate","getLocalDateByEpoch","epoch","date","getTime","getTimezoneOffset","getUTCDate","utc_date","toISOString","substring"],"mappings":"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","file":"main.84c2de.hot-update.js","sourcesContent":["import PendingPromise from '../../../utils/pending-promise';\n\nexport default class ServerTime {\n    constructor(ws) {\n        this.clock_started         = false;\n        this.init_promise          = new PendingPromise();\n        this.ws                    = ws;\n        this.init();\n    }\n\n    async init() {\n        if (!this.clock_started) {\n            this.clock_started = true;\n            clearInterval(this.getTimeInterval);\n            await this.requestTime();\n            this.getTimeInterval = setInterval(this.requestTime.bind(this), 30000);\n        }\n\n        console.log(this.init_promise); // eslint-disable-line\n        return this.init_promise;\n    }\n\n    async requestTime() {\n        this.client_time_at_request = this.getUTCEpoch(new Date());\n        console.log(this.client_time_at_request); // eslint-disable-line\n        const time_response = await this.ws.sendRequest({ time: 1 });\n        console.log(this.time_response); // eslint-disable-line\n        this.processTimeResponse(time_response);\n        this.init_promise.resolve();\n    }\n\n    processTimeResponse(response) {\n        if (response.error) {\n            this.clock_started = false;\n        }\n\n        if (!this.clock_started) {\n            this.init();\n            return;\n        }\n\n        const server_time             = response.time;\n        const client_time_at_response = this.getUTCEpoch(new Date());\n        this.server_time_at_response  = server_time + ((client_time_at_response - this.client_time_at_request) / 2);\n\n        const updateTime = () => {\n            this.server_time_at_response += 1;\n        };\n\n        clearInterval(this.updateTimeInterval);\n        this.updateTimeInterval = setInterval(updateTime, 1000);\n    }\n\n    getEpoch() {\n        if (this.server_time_at_response) {\n            return this.server_time_at_response;\n        }\n\n        throw new Error('Server time is undefined');\n    }\n\n    getLocalDate() {\n        return this.getLocalDateByEpoch(this.getEpoch());\n    }\n    \n    // eslint-disable-next-line class-methods-use-this\n    getLocalDateByEpoch(epoch) {\n        return new Date(epoch * 1000);\n    }\n\n    // eslint-disable-next-line class-methods-use-this\n    getUTCEpoch(date) {\n        return (date.getTime() / 1000) - (date.getTimezoneOffset() * 60);\n    }\n    \n    // eslint-disable-next-line class-methods-use-this\n    getUTCDate(epoch) {\n        const utc_date = new Date(epoch * 1000).toISOString();\n\n        return utc_date.substring(0, 19);\n    }\n}\n"],"sourceRoot":""}